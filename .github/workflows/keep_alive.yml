on:
  schedule:
    - cron: '0 0 */5 * *' # Risks? None. 5 < 7. Smart & Efficient.
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Supabase REST API
        run: |
          # The "Jugad" to keep Supabase active by making a simple read request
          # Use secrets for better security, or replace placeholders directly
          
          URL="${{ secrets.SUPABASE_URL }}"
          KEY="${{ secrets.SUPABASE_ANON_KEY }}"
          
          if [ -z "$URL" ]; then
            echo "Secrets not set. Trying hardcoded values (Replace these or set secrets!)"
            # REPLACE WITH YOUR VALUES FROM .env IF SECRETS NOT WORKING
            # URL="https://vxxoaxdpwzeqoxxkzujh.supabase.co"
            # KEY="your-anon-key"
            echo "Please configure repository secrets: SUPABASE_URL and SUPABASE_ANON_KEY"
            exit 1
          fi

          response=$(curl -s -o /dev/null -w "%{http_code}" -H "apikey: $KEY" -H "Authorization: Bearer $KEY" "$URL/rest/v1/menu_items?select=count&limit=1")
          
          if [ "$response" -eq 200 ] || [ "$response" -eq 206 ]; then
            echo "Success! Supabase is active. HTTP $response"
          else
            echo "Failed to ping. HTTP $response"
            exit 1
          fi
